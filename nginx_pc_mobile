map $http_user_agent $root {
    "~*(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino" /data/kingfisher-mobile/current;
    default /data/alcedinidae/current;
}
server {
    listen 80;
    root $root;

    gzip on;
    gzip_min_length 1000;
    gzip_types      text/html application/xml text/css application/javascript;

    location / {
        try_files $uri /index.html;
    }
    
    location ^~/api/roc {
        rewrite ^/api\/roc/(.+?)$ /$1 break;
        proxy_pass http://localhost:34569;
    }

   location ^~/file/ {
       alias /home/ubuntu/kingfisher-upload/;
   }

   location ^~/socket {
        proxy_pass http://localhost:8002;
   }

   location ^~/api {
        rewrite ^/api/(.+?)$ /$1 break;
        proxy_pass http://localhost:8000;
   }
}
